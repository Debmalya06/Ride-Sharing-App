# Firebase OTP System - Architecture & Diagrams ðŸ“Š

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       CLIENT LAYER                          â”‚
â”‚  (React Frontend - OtpVerification.jsx)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“ (HTTP Requests)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API LAYER (Spring Boot)                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚         AuthController / AuthService                  â”‚ â”‚
â”‚  â”‚  /api/auth/send-otp                                   â”‚ â”‚
â”‚  â”‚  /api/auth/verify-login-otp                           â”‚ â”‚
â”‚  â”‚  /api/auth/register                                   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                                    â”‚
           â†“                                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   OTP Service Layer      â”‚    â”‚   Firebase Config        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ OtpService         â”‚â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â†’â”‚ FirebaseConfig     â”‚  â”‚
â”‚  â”‚ (Facade)           â”‚  â”‚    â”‚  â”‚ (Initializer)      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚           â”‚              â”‚    â”‚           â”‚              â”‚
â”‚           â†“              â”‚    â”‚           â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FirebaseOtpServiceâ”‚  â”‚    â”‚  â”‚ Firebase Admin SDK â”‚  â”‚
â”‚  â”‚                    â”‚  â”‚    â”‚  â”‚ (Google Libraries) â”‚  â”‚
â”‚  â”‚ â€¢ generateOtp()   â”‚  â”‚    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚ â€¢ generateAndSend â”‚  â”‚    â”‚                          â”‚
â”‚  â”‚ â€¢ verifyOtp()     â”‚  â”‚    â”‚                          â”‚
â”‚  â”‚ â€¢ canSendOtp()    â”‚  â”‚    â”‚                          â”‚
â”‚  â”‚ â€¢ cleanup()       â”‚  â”‚    â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚           â”‚              â”‚
â”‚           â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Mock OTP Console   â”‚  â”‚
â”‚  â”‚ Output (Dev Mode)  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATABASE LAYER                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  OtpVerification Table                                 â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ id  â”‚ phoneNumber â”‚ otp  â”‚ expiresAt â”‚ isUsed  â”‚  â”‚ â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚ â”‚
â”‚  â”‚  â”‚ 1   â”‚ +91987...   â”‚ 12345â”‚ 2025-11..â”‚ false   â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ 2   â”‚ +91987...   â”‚ 67890â”‚ 2025-11..â”‚ true    â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## OTP Flow Diagram

### Login with OTP Flow

```
USER BROWSER                    BACKEND                     DATABASE
    â”‚                              â”‚                            â”‚
    â”‚ 1. Enter phone number        â”‚                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                            â”‚
    â”‚                              â”‚ 2. Generate 6-digit OTP    â”‚
    â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
    â”‚                              â”‚                    Save OTP â”‚
    â”‚                              â”‚ â† â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
    â”‚   3. Print to console â¬… â”€ â”€ â”€â”¤                            â”‚
    â”‚   (Mock OTP)                  â”‚                            â”‚
    â”‚   ðŸ” OTP: 123456              â”‚                            â”‚
    â”‚                              â”‚                            â”‚
    â”‚ 4. Copy OTP from console    â”‚                            â”‚
    â”‚    Enter OTP in form         â”‚                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚                            â”‚
    â”‚                              â”‚ 5. Verify OTP from DB      â”‚
    â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
    â”‚                              â”‚                   Check DB â”‚
    â”‚                              â”‚ â† â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
    â”‚                              â”‚                            â”‚
    â”‚                              â”‚ 6. Mark OTP as used        â”‚
    â”‚                              â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚
    â”‚                              â”‚                    Update â”‚
    â”‚                              â”‚ â† â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
    â”‚                              â”‚                            â”‚
    â”‚ 7. Return JWT token          â”‚                            â”‚
    â”‚ â† â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”¤                            â”‚
    â”‚                              â”‚                            â”‚
    â”‚ 8. Store token + Redirect    â”‚                            â”‚
    â”‚    to dashboard              â”‚                            â”‚
    â”‚                              â”‚                            â”‚
```

---

## Registration with OTP Flow

```
USER BROWSER                    BACKEND                     DATABASE
    â”‚                              â”‚                            â”‚
    â”‚ 1. Enter phone number        â”‚                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ /send-registration-otp    â”‚
    â”‚                              â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
    â”‚                              â”‚ â”‚ Check phone not registered
    â”‚                              â”‚ â”‚ Save OTP                  â”‚
    â”‚                              â”‚ â† â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
    â”‚                              â”‚                            â”‚
    â”‚   2. Print to console â¬… â”€ â”€ â”€â”¤                            â”‚
    â”‚   (Mock OTP)                  â”‚                            â”‚
    â”‚   ðŸ” OTP: 654321              â”‚                            â”‚
    â”‚                              â”‚                            â”‚
    â”‚ 3. Fill registration form    â”‚                            â”‚
    â”‚    â€¢ Name                    â”‚                            â”‚
    â”‚    â€¢ Email                   â”‚                            â”‚
    â”‚    â€¢ Password                â”‚                            â”‚
    â”‚    â€¢ Role                    â”‚                            â”‚
    â”‚    â€¢ OTP (from console)      â”‚                            â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ â”‚ /register                 â”‚
    â”‚                              â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’
    â”‚                              â”‚ â”‚ Verify OTP               â”‚
    â”‚                              â”‚ â”‚ Create User Account       â”‚
    â”‚                              â”‚ â”‚ Save User                 â”‚
    â”‚                              â”‚ â† â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€
    â”‚                              â”‚                            â”‚
    â”‚ 4. Return JWT token          â”‚                            â”‚
    â”‚ â† â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€â”¤                            â”‚
    â”‚                              â”‚                            â”‚
    â”‚ 5. Store token + Redirect    â”‚                            â”‚
    â”‚    to dashboard              â”‚                            â”‚
    â”‚                              â”‚                            â”‚
```

---

## Component Interaction Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FirebaseConfig     â”‚
â”‚  (Initialization)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ @Bean
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FirebaseApp        â”‚      â”‚ Firebase Admin   â”‚
â”‚  Singleton          â”‚â†â”€ â”€ â”€â”¤ SDK              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–³
           â”‚
           â”‚ Used by
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FirebaseOtpService  â”‚
â”‚ (OTP Logic)         â”‚
â”‚ â€¢ Generate OTP      â”‚
â”‚ â€¢ Verify OTP        â”‚
â”‚ â€¢ Rate Limiting     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–³
           â”‚
           â”‚ Delegates to
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OtpService         â”‚
â”‚  (Facade)           â”‚
â”‚  (Public Interface) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–³
           â”‚
           â”‚ Used by
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthService        â”‚
â”‚  (Business Logic)   â”‚
â”‚  â€¢ Login            â”‚
â”‚  â€¢ Register         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â–³
           â”‚
           â”‚ Used by
           â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AuthController     â”‚
â”‚  (REST API)         â”‚
â”‚  â€¢ /api/auth/*      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Model

```
OtpVerification Entity
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Field          â”‚ Type      â”‚ Length  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ id             â”‚ Long      â”‚ -       â”‚
â”‚ phoneNumber    â”‚ String    â”‚ 20      â”‚
â”‚ otp            â”‚ String    â”‚ 6       â”‚
â”‚ expiresAt      â”‚ DateTime  â”‚ -       â”‚
â”‚ isUsed         â”‚ Boolean   â”‚ -       â”‚
â”‚ createdAt      â”‚ DateTime  â”‚ -       â”‚
â”‚ verifiedAt     â”‚ DateTime  â”‚ -       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Helper Methods:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ isExpired()   â†’ Boolean          â”‚
â”‚ isValid()     â†’ Boolean          â”‚
â”‚ markAsUsed()  â†’ void             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Request/Response Flow

### Request: Send OTP

```json
REQUEST:
POST /api/auth/send-otp
Content-Type: application/json

{
  "phoneNumber": "9876543210"
}

RESPONSE (Success):
HTTP 200 OK
{
  "status": "SUCCESS",
  "message": "OTP sent successfully",
  "data": {
    "phoneNumber": "+919876543210",
    "expiresIn": 300
  }
}

RESPONSE (Rate Limited):
HTTP 429 Too Many Requests
{
  "status": "ERROR",
  "message": "Too many OTP requests. Please try again after 1 hour."
}
```

### Request: Verify OTP

```json
REQUEST:
POST /api/auth/verify-login-otp
Content-Type: application/json

{
  "phoneNumber": "9876543210",
  "otp": "123456"
}

RESPONSE (Success):
HTTP 200 OK
{
  "status": "SUCCESS",
  "message": "OTP verified successfully",
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "id": 123,
    "phoneNumber": "+919876543210",
    "name": "John Doe",
    "role": "PASSENGER",
    "averageRating": 4.5
  }
}

RESPONSE (Invalid):
HTTP 401 Unauthorized
{
  "status": "ERROR",
  "message": "Invalid or expired OTP",
  "token": null,
  "user": null
}
```

---

## Execution Timeline

```
Time          Event
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
0:00          User clicks "Send OTP"
              â†“
0:05          Request reaches backend
              FirebaseOtpService.generateAndSendOtp()
              â†“
0:10          OTP saved to database
              Mock OTP prints to console
              Response sent to frontend
              â†“
0:15          User copies OTP from console
              Enters OTP in form
              â†“
0:20          Request reaches backend: /verify-login-otp
              FirebaseOtpService.verifyOtp()
              â†“
0:25          OTP verified
              Marked as used
              JWT token generated
              â†“
0:30          Response sent with token
              Frontend stores token
              â†“
5:00          (OTP expires - can't use anymore)
              
12:00-00:01   OtpService.cleanupExpiredOtps() runs
              (Scheduled task - cleans DB)
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Incoming Request     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Validate   â”‚
    â”‚  Input?     â”‚
    â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚      â”‚
      NO     YES
       â”‚      â”‚
       â†“      â†“
    â”Œâ”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚   â”‚ Check Rate Limit â”‚
    â”‚  â”‚   â””â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
    â”‚  â”‚      â”‚          â”‚
    â”‚  â”‚   EXCEEDED    ALLOWED
    â”‚  â”‚      â”‚          â”‚
    â”‚  â”‚      â†“          â†“
    â”‚  â”‚   â”Œâ”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  â”‚   â”‚  â”‚    â”‚ Generate OTP     â”‚
    â”‚  â”‚   â”‚  â”‚    â”‚ Save to DB       â”‚
    â”‚  â”‚   â”‚  â”‚    â”‚ Print to Console â”‚
    â”‚  â”‚   â”‚  â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  â”‚   â”‚  â”‚             â”‚
    â”‚  â”‚   â”‚  â”‚             â†“
    â”‚  â”‚   â”‚  â”‚          SUCCESS
    â”‚  â”‚   â”‚  â”‚
    â””â”€â”€â”´â”€â”€â”´â”€â”€â”˜
       â”‚  â”‚  â”‚
       â”‚  â”‚  â””â”€ Return Error Response
       â”‚  â””â”€â”€â”€â”€â”€ Return Error Response
       â””â”€â”€â”€â”€â”€â”€â”€â”€ Return Error Response
```

---

## Migration From Twilio to Firebase

```
BEFORE (Twilio):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OtpService      â”‚
â”‚ â€¢ Uses Twilio    â”‚
â”‚ â€¢ Sends Real SMS â”‚
â”‚ â€¢ Costs $$$      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AFTER (Firebase):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OtpService      â”‚
â”‚ â€¢ Uses Firebase  â”‚
â”‚ â€¢ Mock OTP       â”‚
â”‚ â€¢ Free           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â†’ FirebaseOtpService
     â”‚       â”‚
     â”‚       â”œâ”€â†’ FirebaseConfig
     â”‚       â”‚
     â”‚       â”œâ”€â†’ Firebase Admin SDK
     â”‚       â”‚
     â”‚       â””â”€â†’ Mock Console OTP
     â”‚
     â””â”€â†’ (Easy to add real SMS later)
```

---

## Firebase Initialization Process

```
1. Application Starts
   â†“
2. FirebaseConfig Bean Created
   â†“
3. Load Service Account Key
   firebase-service-account-key.json
   â†“
4. Create GoogleCredentials
   â†“
5. Build FirebaseOptions
   â”œâ”€ Set Credentials
   â”œâ”€ Set Project ID
   â””â”€ Set Other Options
   â†“
6. Initialize FirebaseApp
   â†“
7. Verify No Errors
   â†“
8. Print Success Message
   âœ… Firebase initialized successfully!
   â†“
9. Ready for OTP Operations
```

---

## Rate Limiting Algorithm

```
When OTP Requested:
â†“
1. Get phone number
   â†“
2. Calculate "1 hour ago" timestamp
   oneHourAgo = now - 60 minutes
   â†“
3. Query database:
   COUNT(otp) WHERE phone = requested
         AND created_at > oneHourAgo
   â†“
4. Check result:
   â”œâ”€ If count < 5 â†’ ALLOWED âœ…
   â”‚
   â””â”€ If count â‰¥ 5 â†’ RATE_LIMITED âŒ
                    Return error:
                    "Too many OTP requests..."
   â†“
5. Auto-cleanup runs periodically
   Delete all expired OTPs from DB
```

---

## Development vs Production Comparison

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¦â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Feature      â•‘ Development   â•‘ Production     â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¬â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘ OTP Sending    â•‘ Mock Console  â•‘ Real SMS       â•‘
â•‘ Where OTP Goes â•‘ Terminal Logs â•‘ User's Phone   â•‘
â•‘ Cost           â•‘ Free          â•‘ Per SMS fee    â•‘
â•‘ Setup          â•‘ Just add JSON â•‘ Add SMS API    â•‘
â•‘ Testing        â•‘ Easy          â•‘ Need test SMS  â•‘
â•‘ Security       â•‘ Dev-friendly  â•‘ Secured        â•‘
â•‘ User Flow      â•‘ Copy paste    â•‘ Auto fill      â•‘
â•‘ Reliability    â•‘ 100% (Local)  â•‘ Depends on SMS â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•©â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

**For more details, see:**
- FIREBASE_OTP_SETUP_GUIDE.md - Complete setup
- FIREBASE_IMPLEMENTATION_GUIDE.md - Quick start
- FIREBASE_OTP_API_REFERENCE.md - API documentation

